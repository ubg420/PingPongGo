/* esm.sh - @poki/netlib@0.0.16 */
var H=Object.create;var x=Object.defineProperty,K=Object.defineProperties,X=Object.getOwnPropertyDescriptor,Y=Object.getOwnPropertyDescriptors,Z=Object.getOwnPropertyNames,R=Object.getOwnPropertySymbols,ee=Object.getPrototypeOf,$=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var C=(a,t,e)=>t in a?x(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,S=(a,t)=>{for(var e in t||(t={}))$.call(t,e)&&C(a,e,t[e]);if(R)for(var e of R(t))te.call(t,e)&&C(a,e,t[e]);return a},M=(a,t)=>K(a,Y(t));var j=(a,t)=>()=>(t||a((t={exports:{}}).exports,t),t.exports);var ne=(a,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Z(t))!$.call(a,i)&&i!==e&&x(a,i,{get:()=>t[i],enumerable:!(n=X(t,i))||n.enumerable});return a};var ie=(a,t,e)=>(e=a!=null?H(ee(a)):{},ne(t||!a||!a.__esModule?x(e,"default",{value:a,enumerable:!0}):e,a));var c=(a,t,e)=>C(a,typeof t!="symbol"?t+"":t,e);var w=(a,t,e)=>new Promise((n,i)=>{var l=s=>{try{o(e.next(s))}catch(d){i(d)}},h=s=>{try{o(e.throw(s))}catch(d){i(d)}},o=s=>s.done?n(s.value):Promise.resolve(s.value).then(l,h);o((e=e.apply(a,t)).next())});var W=j((ue,I)=>{"use strict";var se=Object.prototype.hasOwnProperty,p="~";function y(){}Object.create&&(y.prototype=Object.create(null),new y().__proto__||(p=!1));function re(a,t,e){this.fn=a,this.context=t,this.once=e||!1}function q(a,t,e,n,i){if(typeof e!="function")throw new TypeError("The listener must be a function");var l=new re(e,n||a,i),h=p?p+t:t;return a._events[h]?a._events[h].fn?a._events[h]=[a._events[h],l]:a._events[h].push(l):(a._events[h]=l,a._eventsCount++),a}function E(a,t){--a._eventsCount===0?a._events=new y:delete a._events[t]}function g(){this._events=new y,this._eventsCount=0}g.prototype.eventNames=function(){var t=[],e,n;if(this._eventsCount===0)return t;for(n in e=this._events)se.call(e,n)&&t.push(p?n.slice(1):n);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(e)):t};g.prototype.listeners=function(t){var e=p?p+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,l=n.length,h=new Array(l);i<l;i++)h[i]=n[i].fn;return h};g.prototype.listenerCount=function(t){var e=p?p+t:t,n=this._events[e];return n?n.fn?1:n.length:0};g.prototype.emit=function(t,e,n,i,l,h){var o=p?p+t:t;if(!this._events[o])return!1;var s=this._events[o],d=arguments.length,f,r;if(s.fn){switch(s.once&&this.removeListener(t,s.fn,void 0,!0),d){case 1:return s.fn.call(s.context),!0;case 2:return s.fn.call(s.context,e),!0;case 3:return s.fn.call(s.context,e,n),!0;case 4:return s.fn.call(s.context,e,n,i),!0;case 5:return s.fn.call(s.context,e,n,i,l),!0;case 6:return s.fn.call(s.context,e,n,i,l,h),!0}for(r=1,f=new Array(d-1);r<d;r++)f[r-1]=arguments[r];s.fn.apply(s.context,f)}else{var u=s.length,v;for(r=0;r<u;r++)switch(s[r].once&&this.removeListener(t,s[r].fn,void 0,!0),d){case 1:s[r].fn.call(s[r].context);break;case 2:s[r].fn.call(s[r].context,e);break;case 3:s[r].fn.call(s[r].context,e,n);break;case 4:s[r].fn.call(s[r].context,e,n,i);break;default:if(!f)for(v=1,f=new Array(d-1);v<d;v++)f[v-1]=arguments[v];s[r].fn.apply(s[r].context,f)}}return!0};g.prototype.on=function(t,e,n){return q(this,t,e,n,!1)};g.prototype.once=function(t,e,n){return q(this,t,e,n,!0)};g.prototype.removeListener=function(t,e,n,i){var l=p?p+t:t;if(!this._events[l])return this;if(!e)return E(this,l),this;var h=this._events[l];if(h.fn)h.fn===e&&(!i||h.once)&&(!n||h.context===n)&&E(this,l);else{for(var o=0,s=[],d=h.length;o<d;o++)(h[o].fn!==e||i&&!h[o].once||n&&h[o].context!==n)&&s.push(h[o]);s.length?this._events[l]=s.length===1?s[0]:s:E(this,l)}return this};g.prototype.removeAllListeners=function(t){var e;return t?(e=p?p+t:t,this._events[e]&&E(this,e)):(this._events=new y,this._eventsCount=0),this};g.prototype.off=g.prototype.removeListener;g.prototype.addListener=g.prototype.on;g.prefixed=p;g.EventEmitter=g;typeof I!="undefined"&&(I.exports=g)});var G=j((ge,k)=>{var Q=W();function _(a,t,e,n){Object.defineProperty(a,t,{get:e,set:n,enumerable:!0,configurable:!0})}_(k.exports,"DefaultSignalingURL",function(){return V});_(k.exports,"DefaultRTCConfiguration",function(){return z});_(k.exports,"DefaultDataChannels",function(){return F});_(k.exports,"Network",function(){return D});var O=5e3,b="turn:turn.rtc.poki.com",A=class{constructor(t){c(this,"signaling");c(this,"cachedCredentials");c(this,"cachedCredentialsExpireAt");c(this,"runningPromise");this.signaling=t,this.cachedCredentialsExpireAt=0}fillCredentials(t){return w(this,null,function*(){var l,h;let e=JSON.parse(JSON.stringify(t));if(t.testproxyURL!==void 0||!((h=(l=e.iceServers)==null?void 0:l.some(o=>o.urls===b||o.urls.includes(b)))!=null?h:!1)||e.iceServers===void 0)return e;this.runningPromise===void 0&&(this.runningPromise=new Promise(o=>{if(this.cachedCredentials!=null&&this.cachedCredentialsExpireAt>performance.now()){o(this.cachedCredentials);return}let s=setTimeout(()=>{o({type:"credentials"}),this.cachedCredentials={type:"credentials"},this.cachedCredentialsExpireAt=performance.now()+O},O);this.signaling.request({type:"credentials"}).then(d=>{var f;d.type==="credentials"&&(this.cachedCredentials=d,this.cachedCredentialsExpireAt=performance.now()+(((f=d.lifetime)!=null?f:0)-60)*1e3,clearTimeout(s),o(d))}).catch(()=>{clearTimeout(s),o({type:"credentials"}),this.cachedCredentials={type:"credentials"},this.cachedCredentialsExpireAt=performance.now()+O})}));let i=yield this.runningPromise;return this.runningPromise=void 0,i.url===void 0||e.iceServers.forEach(o=>{var s;(o.urls===b||o.urls.includes(b))&&(o.urls=(s=i.url)!=null?s:"",o.username=i.username,o.credential=i.credential)}),e})}},P=class extends Q.EventEmitter{constructor(e,n,i){super();c(this,"network");c(this,"url");c(this,"ws");c(this,"reconnectAttempt");c(this,"reconnecting");c(this,"receivedID");c(this,"receivedSecret");c(this,"currentLobby");c(this,"currentLobbyInfo");c(this,"currentLeader");c(this,"currentTerm");c(this,"connections");c(this,"replayQueue");c(this,"requests");this.network=e,this.reconnectAttempt=0,this.reconnecting=!1,this.currentTerm=0,this.requests=new Map,this.url=i,this.connections=n,this.replayQueue=new Map,this.ws=this.connect(),setInterval(()=>{this.ping()},5e3)}connect(){let e=new WebSocket(this.url),n=()=>{this.reconnectAttempt=0,this.reconnecting=!1,this.send({type:"hello",game:this.network.gameID,id:this.receivedID,secret:this.receivedSecret})},i=o=>{let s=new m("socket-error","unexpected websocket error",o);this.network._onSignalingError(s),e.readyState===WebSocket.CLOSED&&(this.reconnecting=!1,e.removeEventListener("open",n),e.removeEventListener("error",i),e.removeEventListener("message",l),e.removeEventListener("close",h),setTimeout(()=>{this.reconnect()},100))},l=o=>{this.handleSignalingMessage(o.data).catch(s=>{})},h=()=>{if(!this.network.closing){let o=new m("socket-error","signaling socket closed");this.network._onSignalingError(o)}e.removeEventListener("open",n),e.removeEventListener("error",i),e.removeEventListener("message",l),e.removeEventListener("close",h),setTimeout(()=>{this.reconnect()},100)};return e.addEventListener("open",n),e.addEventListener("error",i),e.addEventListener("message",l),e.addEventListener("close",h),e}reconnect(){if(!(this.reconnecting||this.network.closing)){if(this.close(),this.requests.forEach(e=>e.reject(new m("socket-error","signaling socket closed"))),this.requests.clear(),this.reconnectAttempt>42){this.network.emit("failed"),this.network._onSignalingError(new m("socket-error","giving up on reconnecting to signaling server"));return}this.event("signaling","attempt-reconnect"),this.reconnecting=!0,setTimeout(()=>{this.ws=this.connect()},Math.random()*100*this.reconnectAttempt),this.reconnectAttempt+=1}}close(){this.ws.close()}request(e){return w(this,null,function*(){return yield new Promise((n,i)=>{if(this.ws.readyState!==WebSocket.OPEN){i(new m("socket-error","signaling socket not open"));return}let l=Math.random().toString(36).slice(2);e.rid=l,this.network.log("requesting signaling packet:",e.type);let h=JSON.stringify(e);this.ws.send(h),this.requests.set(l,{resolve:n,reject:i})})})}send(e){if(this.ws.readyState===WebSocket.OPEN){this.network.log("sending signaling packet:",e.type);let n=JSON.stringify(e);this.ws.send(n)}}ping(){if(this.ws.readyState===WebSocket.OPEN){let e=JSON.stringify({type:"ping"});this.ws.send(e)}}handleSignalingMessage(e){return w(this,null,function*(){var n,i,l,h,o,s,d,f;try{let r=JSON.parse(e);if(this.network.log("signaling packet received:",r.type),r.rid!==void 0){let u=this.requests.get(r.rid);u!=null&&(this.requests.delete(r.rid),r.type==="error"?u.reject(new m("server-error",r.message,void 0,r.code)):u.resolve(r))}switch(r.type){case"error":{let u=new m("server-error",r.message,void 0,r.code);if(this.network._onSignalingError(u),r.code==="missing-recipient"&&((n=r.error)==null?void 0:n.recipient)!==void 0){let v=(i=r.error)==null?void 0:i.recipient;this.connections.has(v)&&(this.network.log("cleaning up missing recipient",v),(l=this.connections.get(v))==null||l.close("missing-recipient"))}else r.code==="reconnect-failed"&&this.network.close("reconnect failed")}break;case"welcome":if(this.receivedID!==void 0){this.network.log("signaling reconnected"),this.network.emit("signalingreconnected");return}if(r.id==="")throw new Error("missing id on received welcome packet");this.receivedID=r.id,this.receivedSecret=r.secret,this.network.emit("ready"),this.network._prefetchTURNCredentials();break;case"joined":{let u=r.lobbyInfo.code;if(u==="")throw new Error("missing lobby on received connect packet");this.currentLobby=u,this.currentLeader=r.lobbyInfo.leader,this.currentTerm=r.lobbyInfo.term,this.network.emit("lobby",u,r.lobbyInfo),this.currentLeader!==void 0&&this.network.emit("leader",this.currentLeader)}break;case"leader":if(this.currentLobby===void 0)return;r.term>this.currentTerm&&(this.currentLeader=r.leader,this.currentTerm=r.term,this.network.emit("leader",r.leader));break;case"lobbyUpdated":if(this.currentLobby===void 0)return;this.currentLobbyInfo=r.lobbyInfo,this.network.emit("lobbyUpdated",r.lobbyInfo.code,r.lobbyInfo);break;case"connect":if(this.receivedID===r.id)return;yield this.network._addPeer(r.id,r.polite);for(let u of(h=this.replayQueue.get(r.id))!=null?h:[])yield(o=this.connections.get(r.id))==null?void 0:o._onSignalingMessage(u);this.replayQueue.delete(r.id);break;case"disconnect":this.connections.has(r.id)&&((s=this.connections.get(r.id))==null||s.close());break;case"candidate":case"description":if(this.connections.has(r.source))yield(d=this.connections.get(r.source))==null?void 0:d._onSignalingMessage(r);else{let u=(f=this.replayQueue.get(r.source))!=null?f:[];u.push(r),this.replayQueue.set(r.source,u)}break;case"credentials":this.emit("credentials",r);break;case"ping":break}}catch(r){let u=new m("unknown-error",r);this.network._onSignalingError(u)}})}event(e,n,i){return w(this,null,function*(){return yield new Promise(l=>{setTimeout(()=>{this.send({type:"event",game:this.network.gameID,lobby:this.currentLobby,peer:this.network.id,category:e,action:n,data:i}),l()},0)})})}},m=class{constructor(t,e,n,i){c(this,"type");c(this,"message");c(this,"event");c(this,"code");this.type=t,this.message=e,this.event=n,this.code=i}toString(){return`[${this.type}: ${this.message}]`}},oe=500,ce=50,U="ping",J="pong",L=class{constructor(t,e){c(this,"peer");c(this,"control");c(this,"window");c(this,"lastPingSentAt");c(this,"last");c(this,"average");c(this,"jitter");c(this,"max");c(this,"min");this.peer=t,this.control=e,this.window=[],this.lastPingSentAt=0,this.last=0,this.average=0,this.jitter=0,this.max=0,this.min=0,e!==void 0&&(this.ping(),e.addEventListener("message",n=>this.onMessage(n.data)))}ping(){var t,e;this.lastPingSentAt=performance.now(),((t=this.control)==null?void 0:t.readyState)==="open"&&((e=this.control)==null||e.send(U))}onMessage(t){var i,l;if(t===U){((i=this.control)==null?void 0:i.readyState)==="open"&&((l=this.control)==null||l.send(J));return}if(t!==J)return;let n=performance.now()-this.lastPingSentAt;this.window.unshift(n),this.window.length>ce&&this.window.pop(),this.last=n,this.max=Math.max(...this.window),this.min=Math.min(...this.window),this.average=this.window.reduce((h,o)=>h+o,0)/this.window.length,this.window.length>1&&(this.jitter=this.window.slice(1).map((h,o)=>Math.abs(h-this.window[o])).reduce((h,o)=>h+o,0)/(this.window.length-1)),setTimeout(()=>this.ping(),Math.max(oe-n,0))}},ae=1e3,he=8e3,T=class{constructor(t,e,n,i,l){c(this,"network");c(this,"signaling");c(this,"id");c(this,"config");c(this,"polite");c(this,"conn");c(this,"makingOffer");c(this,"ignoreOffer");c(this,"isSettingRemoteAnswerPending");c(this,"opened");c(this,"closing");c(this,"reconnecting");c(this,"abortReconnectionAt");c(this,"allowNextManualRestartIceAt");c(this,"latency");c(this,"lastMessageReceivedAt");c(this,"politenessTimeout");c(this,"reportLatencyEventTimeout");c(this,"checkStateInterval");c(this,"channels");c(this,"testSessionWrapper");this.network=t,this.signaling=e,this.id=n,this.config=i,this.polite=l,this.makingOffer=!1,this.ignoreOffer=!1,this.isSettingRemoteAnswerPending=!1,this.opened=!1,this.closing=!1,this.reconnecting=!1,this.abortReconnectionAt=0,this.allowNextManualRestartIceAt=0,this.latency=new L(this),this.lastMessageReceivedAt=0,this.channels={},this.network.log("creating peer"),this.testSessionWrapper=void 0,this.conn=new RTCPeerConnection(i),i.testproxyURL===void 0?this.conn.addEventListener("icecandidate",o=>{let s=o.candidate;s!==null&&e.send({type:"candidate",source:this.network.id,recipient:this.id,candidate:s})}):this.testSessionWrapper=le,this.conn.addEventListener("negotiationneeded",()=>{this.politenessTimeout=setTimeout(()=>{w(this,null,function*(){var o;try{if(this.closing)return;this.makingOffer=!0,yield this.conn.setLocalDescription();let s=this.conn.localDescription;s!=null&&(yield(o=this.testSessionWrapper)==null?void 0:o.call(this,s,this.config,this.network.id,this.id),this.signaling.send({type:"description",source:this.network.id,recipient:this.id,description:s}))}catch(s){let d=new m("unknown-error",s);this.network._onSignalingError(d)}finally{this.makingOffer=!1}}).catch(o=>{})},this.polite?100:0)}),this.checkStateInterval=setInterval(()=>{this.checkState()},500),this.conn.addEventListener("signalingstatechange",()=>this.checkState()),this.conn.addEventListener("connectionstatechange",()=>this.checkState()),this.conn.addEventListener("iceconnectionstatechange",()=>this.checkState()),this.network.emit("connecting",this);let h=0;for(let o in this.network.dataChannels){let s=this.conn.createDataChannel(o,M(S({},this.network.dataChannels[o]),{id:h++,negotiated:!0}));s.binaryType="arraybuffer",s.addEventListener("error",d=>this.onError(d)),s.addEventListener("closing",()=>this.checkState()),s.addEventListener("close",()=>this.checkState()),s.addEventListener("open",()=>{!this.opened&&!Object.values(this.channels).some(d=>d.readyState!=="open")&&("control"in this.channels&&(this.latency=new L(this,this.channels.control)),this.politenessTimeout!==void 0&&clearTimeout(this.politenessTimeout),this.signaling.send({type:"connected",id:this.id}),this.opened=!0,this.network.emit("connected",this),this.signaling.event("rtc","connected",{target:this.id}),this.reportLatencyEventTimeout=setTimeout(()=>{this.signaling.event("rtc","avg-latency-at-10s",{target:this.id,latency:`${this.latency.average}`})},1e4))}),s.addEventListener("message",d=>{this.lastMessageReceivedAt=performance.now(),o!=="control"&&this.network.emit("message",this,o,d.data)}),this.channels[o]=s}}close(t){this.closing||(this.closing=!0,this.signaling.send({type:"disconnected",id:this.id,reason:t!=null?t:"normal closure"}),Object.values(this.channels).forEach(e=>e.close()),this.conn.close(),this.network._removePeer(this),this.checkStateInterval!=null&&clearInterval(this.checkStateInterval),this.reportLatencyEventTimeout!=null&&clearTimeout(this.reportLatencyEventTimeout),this.opened&&(this.network.emit("disconnected",this),this.signaling.event("rtc","disconnected",{target:this.id,reason:t!=null?t:"",reconnecting:this.reconnecting?"true":"false"})))}checkState(){var n;let t=performance.now(),e=(n=this.conn.connectionState)!=null?n:this.conn.iceConnectionState;if(!this.closing){if(!this.opened){e==="failed"&&this.close("connecting failed");return}if(Object.values(this.channels).some(i=>i.readyState!=="open")&&this.close("data channel closed"),!this.reconnecting&&(e==="disconnected"||e==="failed")?(this.reconnecting=!0,this.abortReconnectionAt=t+he,this.network.emit("reconnecting",this),this.signaling.event("rtc","attempt-reconnect",{target:this.id})):this.reconnecting&&e==="connected"?(this.reconnecting=!1,this.network.emit("reconnected",this),this.signaling.event("rtc","attempt-reconnected",{target:this.id})):this.reconnecting&&t>this.abortReconnectionAt&&this.close("reconnection timed out"),!this.reconnecting&&"control"in this.channels){let i=this.lastMessageReceivedAt;i!==0&&t-i>ae&&t>this.allowNextManualRestartIceAt&&(this.allowNextManualRestartIceAt=t+1e4,this.conn.restartIce())}}}onError(t){this.network.emit("rtcerror",t),this.network.listenerCount("rtcerror")===0&&console.error("rtcerror not handled:",t),this.checkState(),this.signaling.event("rtc","error",{target:this.id,error:JSON.stringify(t)})}_onSignalingMessage(t){return w(this,null,function*(){var e;switch(t.type){case"candidate":if(t.candidate!=null)try{yield this.conn.addIceCandidate(t.candidate)}catch(n){if(!this.ignoreOffer)throw n}break;case"description":{let{description:n}=t,i=!this.makingOffer&&(this.conn.signalingState==="stable"||this.isSettingRemoteAnswerPending),l=n.type==="offer"&&!i;if(this.ignoreOffer=!this.polite&&l,this.ignoreOffer)return;if(this.isSettingRemoteAnswerPending=n.type==="answer",yield this.conn.setRemoteDescription(n),this.isSettingRemoteAnswerPending=!1,n.type==="offer"){yield this.conn.setLocalDescription();let h=this.conn.localDescription;h!=null&&(yield(e=this.testSessionWrapper)==null?void 0:e.call(this,h,this.config,this.network.id,this.id),this.signaling.send({type:"description",source:this.network.id,recipient:this.id,description:h}))}}break}})}send(t,e){if(!(t in this.channels))throw new Error("unknown channel "+t);let n=this.channels[t];n.readyState==="open"&&n.send(e)}toString(){return`[Peer: ${this.id}]`}};function le(a,t,e,n){return w(this,null,function*(){var l;if(t.testproxyURL===void 0)return;let i=a.sdp.split(`\r
`);i=i.filter(h=>!h.startsWith("a=candidate")||h.includes("127.0.0.1")&&h.includes("udp"));for(let h=0;h<i.length;h++){let o=i[h];if(o.startsWith("a=candidate")&&o.includes("127.0.0.1")){let s=(l=o.split("127.0.0.1 ").pop())==null?void 0:l.split(" ")[0];if(s!=null){let f=yield(yield fetch(`${t.testproxyURL}/create?id=${e+n}&port=${s}`)).text();i[h]=o.replaceAll(` ${s} `,` ${f} `)}}}a.sdp=i.join(`\r
`)})}var D=class extends Q.EventEmitter{constructor(e,n=z,i=V){super();c(this,"gameID");c(this,"rtcConfig");c(this,"_closing");c(this,"peers");c(this,"signaling");c(this,"credentials");c(this,"dataChannels");c(this,"log");c(this,"unloadListener");this.gameID=e,this.rtcConfig=n,this._closing=!1,this.dataChannels=F,this.log=(...l)=>{},this.peers=new Map,this.signaling=new P(this,this.peers,i),this.credentials=new A(this.signaling),this.unloadListener=()=>this.close(),typeof window!="undefined"&&window.addEventListener("unload",this.unloadListener)}list(e){return w(this,null,function*(){if(this._closing||this.signaling.receivedID===void 0)return[];let n=e!=null?JSON.stringify(e):void 0,i=yield this.signaling.request({type:"list",filter:n});return i.type==="lobbies"?i.lobbies:[]})}create(e){return w(this,null,function*(){if(this._closing||this.signaling.receivedID===void 0)return"";let n=yield this.signaling.request(S({type:"create"},e));return n.type==="joined"?n.lobbyInfo.code:""})}join(e,n){return w(this,null,function*(){if(this._closing||this.signaling.receivedID===void 0)return;let i=yield this.signaling.request({type:"join",lobby:e,password:n});if(i.type==="joined")return i.lobbyInfo})}setLobbySettings(e){return w(this,null,function*(){return this._closing||this.signaling.receivedID===void 0?new Error("network is closing or not connected"):(yield this.signaling.request(S({type:"lobbyUpdate"},e)),!0)})}close(e){this._closing||this.signaling.receivedID===void 0||(this._closing=!0,this.emit("close",e),this.id!==""&&this.signaling.send({type:"close",id:this.id,reason:e!=null?e:"normal closure"}),this.peers.forEach(n=>n.close(e)),this.signaling.close(),typeof window!="undefined"&&window.removeEventListener("unload",this.unloadListener))}send(e,n,i){var l;if(!(e in this.dataChannels))throw new Error("unknown channel "+e);this.peers.has(n)&&((l=this.peers.get(n))==null||l.send(e,i))}broadcast(e,n){if(!(e in this.dataChannels))throw new Error("unknown channel "+e);this.peers.forEach(i=>i.send(e,n))}_addPeer(e,n){return w(this,null,function*(){var h;let i=yield this.credentials.fillCredentials(this.rtcConfig);i.iceServers=(h=i.iceServers)==null?void 0:h.filter(o=>!(o.urls.includes("turn:")&&o.username===void 0));let l=new T(this,this.signaling,e,i,n);this.peers.set(e,l)})}_removePeer(e){return this.peers.delete(e.id)}_prefetchTURNCredentials(){this.credentials.fillCredentials(this.rtcConfig).catch(()=>{})}_onSignalingError(e){this.emit("signalingerror",e),this.listenerCount("signalingerror")===0&&console.error("signallingerror not handled:",e),this.signaling.event("signaling","error",{error:JSON.stringify(e)})}_forceReconnectSignaling(){this.signaling.close()}get id(){var e;return(e=this.signaling.receivedID)!=null?e:""}get closing(){return this._closing}get size(){return this.peers.size}get currentLobby(){return this.signaling.currentLobby}get currentLobbyInfo(){return this.signaling.currentLobbyInfo}get currentLeader(){return this.signaling.currentLeader}},V="wss://netlib.poki.io/v0/signaling",z={iceServers:[{urls:["stun:stun.l.google.com:19302"]},{urls:b}]},F={reliable:{ordered:!0},unreliable:{ordered:!0,maxRetransmits:0},control:{ordered:!1}}});var N=ie(G()),B,pe=(B=N.default)!=null?B:N;window.netlib=pe;
//# sourceMappingURL=netlib.bundle.mjs.map